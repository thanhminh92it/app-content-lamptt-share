(function(){var c=Alfresco.util.siteURL;Alfresco.CreateContentMgr=function h(j){Alfresco.CreateContentMgr.superclass.constructor.call(this,"Alfresco.CreateContentMgr",j);YAHOO.Bubbling.on("formContentReady",this.onFormContentReady,this);YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);return this};YAHOO.extend(Alfresco.CreateContentMgr,Alfresco.component.Base,{options:{isContainer:false,siteId:null,isEntity:false},onFormContentReady:function a(l,j){var k=j[1].buttons.submit;k.set("label",this.msg("button.create"));var m=j[1].buttons.cancel;m.addListener("click",this.onCancelButtonClick,null,this)},onBeforeFormRuntimeInit:function i(k,j){j[1].runtime.setAJAXSubmit(true,{successCallback:{fn:this.onCreateContentSuccess,scope:this},failureCallback:{fn:this.onCreateContentFailure,scope:this}})},onCreateContentSuccess:function d(j){var l=null,k=this;if(j.json&&j.json.persistedObject){l=new Alfresco.util.NodeRef(j.json.persistedObject);if(this.options.siteId&&this.options.siteId!==""&&(!this.options.isContainer||this.options.isEntity)){beCPG.util.postActivity(this.options.siteId,"org.alfresco.documentlibrary."+(this.options.isEntity?"entity":"file")+"-created","{cm:name}",this._getDetailsUrl(l),{appTool:"documentlibrary",nodeRef:l.toString()},function(){k._navigateForward(l)})}else{this._navigateForward(l)}}else{this._navigateForward(l)}},onCreateContentFailure:function f(j){var k=this.msg("create-content-mgr.create.failed");if(j.json&&j.json.message){k=k+": "+j.json.message}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:k})},onCancelButtonClick:function e(k,j){this._navigateForward()},_navigateForward:function b(j){if(YAHOO.lang.isObject(j)){window.location.href=c(this._getDetailsUrl(j))}else{if(document.referrer){if(document.referrer.match(/documentlibrary([?]|$)/)||document.referrer.match(/repository([?]|$)/)){history.go(-1)}else{document.location.href=document.referrer}}else{if(this.options.siteId&&this.options.siteId!==""){window.location.href=c("documentlibrary")}else{if(Alfresco.constants.PORTLET){window.location.href=c("repository")}else{window.location.href=Alfresco.constants.URL_CONTEXT}}}}},_getDetailsUrl:function g(j){if(this.options.isEntity){return"entity-details?nodeRef="+j.toString()}return(this.options.isContainer?"folder":"document")+"-details?nodeRef="+j.toString()}})})();