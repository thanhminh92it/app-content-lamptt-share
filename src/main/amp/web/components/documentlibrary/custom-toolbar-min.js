(function(){var f=YAHOO.util.Dom,j=YAHOO.util.Event,a=YAHOO.util.Element;var d=Alfresco.util.encodeHTML,e=Alfresco.util.siteURL;beCPG.custom.DocListToolbar=function i(k){beCPG.custom.DocListToolbar.superclass.constructor.call(this,k);return this};YAHOO.extend(beCPG.custom.DocListToolbar,Alfresco.DocListToolbar,{entityLinkCustomClass:null,onReady:function h(){if(f.get(this.id+"-tb-body")!=null){if(f.get(this.id+"-createContent-button")){this.widgets.createContent=Alfresco.util.createYUIButton(this,"createContent-button",this.onCreateContent,{type:"menu",menu:"createContent-menu",lazyloadmenu:false,disabled:true,value:"CreateChildren"});var n=this.widgets.createContent.getMenu(),l=0;if(this.options.createContentActions.length!==0){var B=[],m,x,o,A,t,u;for(var y=0;y<this.options.createContentActions.length;y++){x=this.options.createContentActions[y];A={parent:n};o=null;if(x.type=="javascript"){A.onclick={fn:function(D,C,G){var F=Alfresco.util.deepCopy(this.doclistMetadata.parent);var E={nodeRef:F.nodeRef,node:F,jsNode:new Alfresco.util.Node(F)};this[G.params["function"]].call(this,E)},obj:x,scope:this};o="#"}else{if(x.type=="pagelink"){o=e(x.params.page)}else{if(x.type=="link"){o=x.params.href}}}t='<a href="'+o+'" rel="'+x.permission+'"><span style="background-image:url('+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+x.icon+'-file-16.png)" class="'+x.icon+'-file">'+this.msg(x.label)+"</span></a>";u=document.createElement("li");u.innerHTML=t;m=new YAHOO.widget.MenuItem(u,A);B.push(m)}n.addItems(B,l);l++}if(this.options.createContentByTemplateEnabled){var u=document.createElement("li");u.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-node")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",u,true),"click",function(C){j.preventDefault(C);j.stopEvent(C)});var w=document.createElement("div");w.innerHTML='<div class="bd"><ul></ul></div>';var r=document.createElement("li");r.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-folder")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",r,true),"click",function(C){j.preventDefault(C);j.stopEvent(C)});var k=document.createElement("div");k.innerHTML='<div class="bd"><ul></ul></div>';var q=new YAHOO.widget.MenuItem(u,{parent:n,submenu:w});var z=new YAHOO.widget.MenuItem(r,{parent:n,submenu:k});n.addItems([q,z],l);l++;var p=this.widgets.createContent.getMenu().getSubmenus(),v=p.length>0?p[0]:null;if(v){v.subscribe("beforeShow",this.onCreateByTemplateNodeBeforeShow,this,true);v.subscribe("click",this.onCreateByTemplateNodeClick,this,true)}var s=p.length>1?p[1]:null;if(s){s.subscribe("beforeShow",this.onCreateByTemplateFolderBeforeShow,this,true);s.subscribe("click",this.onCreateByTemplateFolderClick,this,true)}}n.render();this.dynamicControls.push(this.widgets.createContent)}this.widgets.newFolder=Alfresco.util.createYUIButton(this,"newFolder-button",this.onNewFolder,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.newFolder);this.widgets.fileUpload=Alfresco.util.createYUIButton(this,"fileUpload-button",this.onFileUpload,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.fileUpload);this.widgets.syncToCloud=Alfresco.util.createYUIButton(this,"syncToCloud-button",this.onSyncToCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.syncToCloud);this.widgets.unsyncFromCloud=Alfresco.util.createYUIButton(this,"unsyncFromCloud-button",this.onUnsyncFromCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.unsyncFromCloud);this.widgets.bulkEdit=Alfresco.util.createYUIButton(this,"bulkEdit-button",this.onBulkEdit,{disabled:false});this.dynamicControls.push(this.widgets.bulkEdit);this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.dynamicControls.push(this.widgets.selectedItems);if(f.get(this.id+"hideNavBar-button")){this.widgets.hideNavBar=Alfresco.util.createYUIButton(this,"hideNavBar-button",this.onHideNavBar,{type:"checkbox",checked:!this.options.hideNavBar});if(this.widgets.hideNavBar!==null){this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));f.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.dynamicControls.push(this.widgets.hideNavBar)}}f.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.widgets.rssFeed=Alfresco.util.createYUIButton(this,"rssFeed-button",null,{type:"link"});this.dynamicControls.push(this.widgets.rssFeed);this.widgets.folderUp=Alfresco.util.createYUIButton(this,"folderUp-button",this.onFolderUp,{disabled:true,title:this.msg("button.up")});this.dynamicControls.push(this.widgets.folderUp);f.setStyle(this.id+"-tb-body","visibility","visible")}this.modules.actions=new Alfresco.module.DoclibActions();this.modules.docList=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");this.services.preferences=new Alfresco.service.Preferences()},onBulkEdit:function b(o,n,m){var l=n,k=l.getElementsByTagName("a")[0];if(k&&k.nodeName=="A"){k.href=YAHOO.lang.substitute(k.href,{nodeRef:this.doclistMetadata.parent.nodeRef});if(k.href.indexOf("%7BnodeRef%7D")!==-1){k.href=k.href.replace("%7BnodeRef%7D",encodeURIComponent(this.doclistMetadata.parent.nodeRef))}}},onDoclistMetadata:function c(l,k){var m=k[1];this.entityLinkCustomClass=null;this.folderDetailsUrl=null;if(m&&m.metadata){this.doclistMetadata=Alfresco.util.deepCopy(m.metadata);if(m.metadata.parent&&m.metadata.parent.nodeRef){if(beCPG.util.isEntity(m.metadata.parent)){this.entityLinkCustomClass=m.metadata.parent.type.replace(":","_");this.folderDetailsUrl=e("entity-details?nodeRef="+m.metadata.parent.nodeRef)}else{this.folderDetailsUrl=e("folder-details?nodeRef="+m.metadata.parent.nodeRef)}}}},_generateBreadcrumb:function g(){var r=f.get(this.id+"-breadcrumb");if(r===null){return}r.innerHTML="";var z=this.currentPath.split("/");if(this.currentPath==="/"){z=["/"]}var s=this,u=z.concat();u[0]=Alfresco.util.message("node.root",this.currentFilter.filterOwner);var t=function l(C,B){f.addClass(C.target.parentNode,"highlighted");j.stopEvent(C)};var A=function o(D,C){var B=s.currentFilter;B.filterData=C;YAHOO.Bubbling.fire("changeFilter",B);j.stopEvent(D)};var x=new a(r),p,q,k,y;for(var n=0,m=z.length;n<m;++n){p=z.slice(0,n+1).join("/");q=new a(document.createElement("div"));q.addClass("crumb");q.addClass("documentDroppable");q.addClass("documentDroppableHighlights");if(n>0){k=new a(document.createElement("a"),{href:"#",innerHTML:"&nbsp;"});k.on("click",A,p);k.addClass("icon");if(m-n<2&&this.entityLinkCustomClass!=null){k.addClass("entity");k.addClass(this.entityLinkCustomClass)}k.addClass("filter-"+d(this.currentFilter.filterId));q.appendChild(k)}if(m-n<2){y=new a(document.createElement("span"),{innerHTML:(this.folderDetailsUrl)?'<a href="'+this.folderDetailsUrl+'">'+d(u[n])+"</a>":d(u[n])});y.addClass("label");q.appendChild(y);x.appendChild(q)}else{y=new a(document.createElement("a"),{href:"",innerHTML:d(u[n])});y.addClass("folder");y.on("click",A,p);q.appendChild(y);x.appendChild(q);x.appendChild(new a(document.createElement("div"),{innerHTML:"&gt;",className:"separator"}))}}var w=f.get(this.id+"-breadcrumb");var v=f.getElementsByClassName("crumb","div",w);for(var n=0,m=v.length;n<m;n++){new YAHOO.util.DDTarget(v[n])}}})})();