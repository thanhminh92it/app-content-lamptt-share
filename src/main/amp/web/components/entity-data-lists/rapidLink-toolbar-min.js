(function(){beCPG.component.RapidLinkToolbar=function(f){beCPG.component.RapidLinkToolbar.superclass.constructor.call(this,"beCPG.component.RapidLinkToolbar",f,["button","container"]);this.name="beCPG.component.EntityDataListToolbar";return this};YAHOO.extend(beCPG.component.RapidLinkToolbar,Alfresco.component.Base);YAHOO.lang.augmentObject(beCPG.component.RapidLinkToolbar.prototype,{options:{entity:null,dataListNodeRef:null,containerDiv:null,siteId:null,list:null,formWidth:"34em"},currentVariantNodeRef:null,onReady:function b(){var g=[],f=this,i=null;if("packagingList"==this.options.list){i=["packagingMaterial","packagingKit"]}else{if("processList"==this.options.list){i=["resourceProduct"]}else{i=["finishedProduct","rawMaterial","localSemiFinishedProduct","semiFinishedProduct"]}}for(key in i){var h=i[key];g.push({text:'<span class="'+h+'" title="'+f.msg("action.rapid-link.create."+h+".description")+'" >'+f.msg("action.rapid-link.create."+h)+"</span>",onclick:{fn:f.onMenuCreateTypeClick(h),scope:f}})}if("compoList"==this.options.list){g.push({text:'<span class="import" title="'+this.msg("action.rapid-link.import.description")+'" >'+this.msg("action.rapid-link.import")+"</span>",onclick:{fn:this.onClickImport,scope:this}})}g.push({text:'<span class="simulation" title="'+this.msg("action.rapid-link.simulation.description")+'" >'+this.msg("action.rapid-link.simulation")+"</span>",onclick:{fn:this.onClickCreateSimulation,scope:this}});this.widgets.rapidLinkToolbar=new YAHOO.widget.Button({type:"split",label:this.msg("button.rapid-link"),name:"mymenubutton",menu:g,container:this.options.containerDiv,lazyloadmenu:false})},onMenuCreateTypeClick:function d(g){var f=this;return function(j,i,h){var m=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?formId=formulation&itemKind=type&itemId={itemId}&destination={destination}&mode=create&submitType=json&showCancelButton=true&popup=true",{itemId:"bcpg:"+g,destination:f.options.entity.parentNodeRef,});var l=new Alfresco.module.SimpleDialog(f.id+"-createType");l.setOptions({width:f.options.formWidth,templateUrl:m,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:function(n,o){Alfresco.util.populateHTML([o.id+"-dialogTitle",f.msg("action.rapid-link.create."+g)])},scope:this},doBeforeFormSubmit:{fn:function(n){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.create.please-wait")})},scope:this},onSuccess:{fn:function(n){if(n.json){f.addToDataList(n.json.persistedObject,"message.rapid-link.create.success")}},scope:this},onFailure:{fn:function k(n){Alfresco.util.PopupManager.displayMessage({text:f.msg("message.rapid-link.create.failure")})},scope:this}}).show()}},onClickImport:function c(i,h,g){this.modules.entityImporter=new Alfresco.module.SimpleDialog(this.id+"-entityImporter").setOptions({width:this.options.formWidth,templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/entity-importer/entity-importer",actionUrl:Alfresco.constants.PROXY_URI+"becpg/remote/import?destination="+this.options.entity.parentNodeRef,validateOnSubmit:false,firstFocus:this.id+"-entityImporter-supplier-field",doBeforeFormSubmit:{fn:function k(l){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.import.please-wait")})},scope:this},onSuccess:{fn:function f(l){if(l.json){this.addToDataList(l.json[0],"message.rapid-link.import.success")}},scope:this},onFailure:{fn:function j(l){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.import.failure")})},scope:this}});this.modules.entityImporter.show()},onClickCreateSimulation:function e(h,g,f){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.simulation.please-wait")});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"becpg/entity/simulation/create?entityNodeRef="+this.options.entity.nodeRef,successCallback:{fn:function(i){if(i.json){window.location.href=beCPG.util.entityCharactURL(this.options.siteId,i.json.persistedObject,this.options.entity.type)}},scope:this},failureCallback:{fn:function(i){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.simulation.failure")})},scope:this}})},addToDataList:function a(i,j){var f=this,g=null,h="bcpg:"+this.options.list;if("packagingList"==this.options.list){g={alf_destination:f.options.dataListNodeRef,assoc_bcpg_packagingListProduct_added:i,prop_bcpg_packagingListUnit:"P",prop_bcpg_packagingListQty:"0"}}else{if("processList"==this.options.list){g={alf_destination:f.options.dataListNodeRef,assoc_mpm_plResource_added:i};h="mpm:processList"}else{g={alf_destination:f.options.dataListNodeRef,assoc_bcpg_compoListProduct_added:i,prop_bcpg_compoListUnit:"kg",prop_bcpg_compoListQtySubFormula:"0"}}}Alfresco.util.Ajax.jsonRequest({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"api/type/"+h+"/formprocessor",dataObj:g,successCallback:{fn:function(k){if(k.json){YAHOO.Bubbling.fire("dataItemCreated",{nodeRef:k.json.persistedObject,callback:function(l){Alfresco.util.PopupManager.displayMessage({text:f.msg(j)})}})}},scope:this}})}},true)})();