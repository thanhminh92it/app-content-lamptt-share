(function(){beCPG.component.AdminConsole=function(s){beCPG.component.AdminConsole.superclass.constructor.call(this,"beCPG.component.AdminConsole",s,["button","menu","container","json"]);google.load("visualization","1",{packages:["gauge"]});return this};YAHOO.extend(beCPG.component.AdminConsole,Alfresco.component.Base,{options:{memory:0},onReady:function l(){this.widgets.reloadModelButton=Alfresco.util.createYUIButton(this,"reload-model-button",this.onReloadModelClick);this.widgets.reloadConfigButton=Alfresco.util.createYUIButton(this,"reload-config-button",this.onReloadConfigClick);this.widgets.initRepoButton=Alfresco.util.createYUIButton(this,"init-repo-button",this.onInitRepoClick);this.widgets.initAclButton=Alfresco.util.createYUIButton(this,"init-acl-button",this.onInitAclClick);this.widgets.emptyCacheButton=Alfresco.util.createYUIButton(this,"empty-cache-button",this.onEmptyCacheClick);this.widgets.showUsersButton=Alfresco.util.createYUIButton(this,"show-users-button",this.onShowUsersClick);var u=google.visualization.arrayToDataTable([["Label","Value"],[this.msg("label.memory"),this.options.memory]]);var s={width:400,height:120,redFrom:90,redTo:100,yellowFrom:80,yellowTo:90,greenFrom:60,greenTo:80,minorTicks:5};var t=new google.visualization.Gauge(document.getElementById(this.id+"-gauge-div"));t.draw(u,s)},onReloadModelClick:function q(t,s){this.widgets.reloadModelButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/reload-model",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onReloadModelSuccess,scope:this},failureCallback:{fn:this.onReloadModelFailure,scope:this}})},onReloadModelSuccess:function o(s){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.reload-model.success")});this.widgets.reloadModelButton.set("disabled",false)},onReloadModelFailure:function e(s){if(s.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:s.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.reload-model.failure")})}this.widgets.reloadModelButton.set("disabled",false)},onReloadConfigClick:function n(t,s){this.widgets.reloadConfigButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/console/config/reload",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onReloadConfigSuccess,scope:this},failureCallback:{fn:this.onReloadConfigFailure,scope:this}})},onReloadConfigSuccess:function i(s){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.reload-config.success")});this.widgets.reloadConfigButton.set("disabled",false)},onReloadConfigFailure:function r(s){if(s.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:s.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.reload-config.failure")})}this.widgets.reloadModelButton.set("disabled",false)},onInitRepoClick:function c(t,s){this.widgets.initRepoButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/init-repo",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onInitRepoSuccess,scope:this},failureCallback:{fn:this.onInitRepoFailure,scope:this}})},onInitRepoSuccess:function p(s){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-repo.success")});this.widgets.initRepoButton.set("disabled",false)},onInitRepoFailure:function f(s){if(s.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:s.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-repo.failure")})}this.widgets.initRepoButton.set("disabled",false)},onInitAclClick:function h(t,s){this.widgets.initAclButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/reload-acl",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onInitAclSuccess,scope:this},failureCallback:{fn:this.onInitAclFailure,scope:this}})},onInitAclSuccess:function d(s){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-acl.success")});this.widgets.initAclButton.set("disabled",false)},onInitAclFailure:function m(s){if(s.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:s.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-acl.failure")})}this.widgets.initAclButton.set("disabled",false)},onEmptyCacheClick:function b(t,s){this.widgets.emptyCacheButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/reload-cache",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.emptyCacheSuccess,scope:this},failureCallback:{fn:this.emptyCacheFailure,scope:this}})},emptyCacheSuccess:function g(s){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.empty-cache.success")});this.widgets.emptyCacheButton.set("disabled",false)},emptyCacheFailure:function k(s){if(s.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:s.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.empty-cache.failure")})}this.widgets.emptyCacheButton.set("disabled",false)},onShowUsersClick:function a(t,s){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/show-users",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(v){if(v.json){var y=document.createElement("div");var w='<div id="'+this.id+'-show-users-panel" class="about-share"><div class="bd"><ul class="users">';for(j in v.json.users){var u=v.json.users[j];w+="<li >";w+='<span class="avatar" title="'+u.fullName+'">';w+=Alfresco.Share.userAvatar(u.username,64);w+='</span><span class="username" ><a id="yui-gen59" class="theme-color-1" tabindex="0" href="/share/page/user/'+u.username+'/profile">'+u.fullName+"</a></span></li>"}w+="</ul></div></div>";y.innerHTML=w;var x=Dom.getFirstChild(y);this.widgets.panel=Alfresco.util.createYUIPanel(x,{draggable:false,width:"25em"});this.widgets.panel.show()}},scope:this}})}})})();