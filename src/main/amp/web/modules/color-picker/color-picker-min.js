(function(){var e=YAHOO.util.Dom,i=YAHOO.util.Event,a=YAHOO.util.KeyListener;beCPG.module.ColorPicker=function(k){this.name="beCPG.module.ColorPicker";this.id=k;var j=Alfresco.util.ComponentManager.get(this.id);if(j!==null){throw new Error("An instance of beCPG.module.ColorPicker already exists.")}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container"],this.onComponentsLoaded,this);return this};beCPG.module.ColorPicker.prototype={defaultShowConfig:{fieldId:null,nodeRefs:null,itemType:null,selectedColor:null},showConfig:{},widgets:{},onComponentsLoaded:function f(){if(this.id===null){return}},show:function d(j){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,j);if(this.widgets.panel){this.updateConfig();this._showPanel()}else{Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/color-picker/color-picker?htmlid="+this.id,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load html template for properties viewer",execScripts:true});this.widgets.escapeListener=new a(document,{keys:a.KEY.ESCAPE},{fn:this.onCancelButtonClick,scope:this,correctScope:true})}},onTemplateLoaded:function g(l){var p=document.createElement("div");p.innerHTML=l.serverResponse.responseText;var n=YAHOO.util.Dom.getFirstChild(p);this.widgets.panel=Alfresco.util.createYUIPanel(n,{draggable:true,width:"15.2em"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",this.onOkButtonClick);var o=this;var k=function(r){m=YAHOO.util.Dom.getStyle(this,"backgroundColor").match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);if(m){function s(v){var u=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");var t=v&15;var w=(v>>4)&15;return""+u[w]+u[t]}function q(v,u,t){return"#"+s(v)+s(u)+s(t)}rgb=q(m[1],m[2],m[3]);YAHOO.util.Dom.get(o.id+"-hexValue").value=rgb;YAHOO.util.Dom.setStyle(o.id+"-hexValue","backgroundColor",rgb)}};var j=YAHOO.util.Selector.query("div.jfk-palette-colorswatch");YAHOO.util.Event.on(j,"click",k);this.updateConfig();this._showPanel()},updateConfig:function(){var j="#FFFFF";if(this.showConfig.fieldId){j=YAHOO.util.Dom.get(this.showConfig.fieldId).value}else{if(this.showConfig.selectedColor){j=this.showConfig.selectedColor}}YAHOO.util.Dom.get(this.id+"-hexValue").value=j;YAHOO.util.Dom.setStyle(this.id+"-hexValue","backgroundColor",j)},onOkButtonClick:function h(){if(this.showConfig.fieldId){YAHOO.util.Dom.get(this.showConfig.fieldId).value=YAHOO.util.Dom.get(this.id+"-hexValue").value}else{if(this.showConfig.nodeRefs){var j=this;Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"becpg/bulkedit/type/"+this.showConfig.itemType.replace(":","_")+"/bulksave?nodeRefs="+this.showConfig.nodeRefs.join(),dataObj:{prop_bcpg_color:YAHOO.util.Dom.get(this.id+"-hexValue").value},requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(k){if(k.json){YAHOO.Bubbling.fire("refreshDataGrids")}},scope:this},failureMessage:"Cannot update color",})}}this.onCancelButtonClick()},onCancelButtonClick:function b(){this.widgets.panel.hide();this.widgets.escapeListener.disable()},_showPanel:function c(){this.widgets.escapeListener.enable();this.widgets.panel.show()}}})();beCPG.module.getColorPickerInstance=function(){var a="becpg-color-picker-instance";return Alfresco.util.ComponentManager.get(a)||new beCPG.module.ColorPicker(a)};