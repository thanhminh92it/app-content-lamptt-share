(function(){beCPG.module.CustomEntityDataGridActions={};beCPG.module.CustomEntityDataGridActions.prototype={onActionShowDetails:function d(p){var l=YAHOO.lang.isArray(p)?p:[p],q=[];for(var n=0,o=l.length;n<o;n++){q.push(l[n].nodeRef)}var m=Alfresco.constants.URL_SERVICECONTEXT+"modules/entity-charact-details/entity-charact-details?entityNodeRef="+this.options.entityNodeRef+"&itemType="+encodeURIComponent(this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType)+"&dataListName="+encodeURIComponent(this.datalistMeta.name)+"&dataListItems="+q.join(",");this._showPanel(m,this.id)},onActionSelectColor:function d(o){var l=YAHOO.lang.isArray(o)?o:[o],q=[];for(var m=0,n=l.length;m<n;m++){q.push(l[m].nodeRef)}var p=this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType;beCPG.module.getColorPickerInstance().show({nodeRefs:q,itemType:p})},onActionBulkEdit:function c(m){var l=YAHOO.lang.isArray(m)?m:[m],n=this;function o(u,s){var t=[];for(var q=0,r=l.length;q<r;q++){if(!s){t.push(l[q].nodeRef)}else{if(l[q].itemData[u].value){t.push(l[q].itemData[u].value)}else{for(var p in l[q].itemData[u]){t.push(l[q].itemData[u][p].value)}}}}if(!s){n._setupPropsPicker(t)}else{window.location=Alfresco.constants.URL_PAGECONTEXT+"bulk-edit?nodeRefs="+t.join()+"&a=true&r=true"}}this._showWusedPopup("bulk-edit",l,o)},_setupPropsPicker:function h(o){var s=Dom.get(this.id+"-wused-selected-picker").parentNode,r="";if(s!=null){var m=0;var v=0;for(var p=0,w=this.datalistColumns.length;p<w;p++){var n=this.datalistColumns[p];var q=this._buildFormsName(n);var l=n.label;if(!(n.protectedField||n.disabled||n.label=="hidden"||n.readOnly)){var t="";if(v<Math.floor(m/5)){t="reset "}v=Math.floor(m/5);t+="column-"+v;r+='<li class="'+t+'"><input id="propSelected-'+p+'" type="checkbox" name="propChecked" value="'+q+'" /><label for="propSelected-'+p+'" >'+l+"</label></li>";m++}}r='<ul style="width:'+((v+1)*20)+'em;">'+r+"</ul>";s.innerHTML=r;var u=Dom.get(this.id+"-bulk-edit-ft");u.innerHTML='<input id="'+this.id+'-bulk-edit-ok" type="button" value="'+this.msg("button.ok")+'" />';this.widgets.okBkButton=Alfresco.util.createYUIButton(this,"bulk-edit-ok",function(){this.widgets.wUsedPanel.hide();this._onEditSelected(o,s)})}},_buildFormsName:function a(m){var l="";if(m.type=="association"){l="assoc_"}else{l="prop_"}l+=m.name.replace(/:/g,"_");return l},_onEditSelected:function j(o,s){var v=this;var n=Selector.query('input[type="checkbox"]',s);var x=function m(y,z){Alfresco.util.populateHTML([z.id+"-dialogTitle",this.msg("label.edit-selected.title")],[z.id+"-dialogHeader",this.msg("label.edit-selected.header")]);if(Dom.get(z.id+"-form-bulkAction")){Dom.setStyle(z.id+"-form-bulkAction","display","none");Dom.setStyle(z.id+"-form-bulkAction-msg","display","none")}};var u=[];for(var p in n){if(n[p].checked){u.push(n[p].value)}}if(u.length<1){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-selected.nofields")});return false}var t=this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType;var l=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?formId={formId}&bulkEdit=true&fields={fields}&submissionUrl={submissionUrl}&itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&showCancelButton=true",{itemKind:"type",formId:"create",itemId:t,mode:"create",submitType:"json",submissionUrl:"/becpg/bulkedit/type/"+t.replace(":","_")+"/bulksave?nodeRefs="+o.join(),fields:u});var r=new Alfresco.module.SimpleDialog(this.id+"-bulkEditRow");r.setOptions({width:"36em",templateUrl:l,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:x,scope:this},onSuccess:{fn:function q(y){if(o.length>10){v._updateDataGrid.call(v,{page:v.currentPage})}else{for(var z=0,A=o.length;z<A;z++){YAHOO.Bubbling.fire(v.scopeId+"dataItemUpdated",{nodeRef:o[z]})}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-selected.success")})},scope:this},onFailure:{fn:function w(y){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-selected.failure")})},scope:this}}).show()},_showWusedPopup:function i(l,q,n){var s=false;var o='<div class="hd">'+this.msg("header."+l+".picker")+"</div>";o+='<div class="bd">';o+='<form  class="form-container">';o+='<div class="form-fields '+l+'">';o+='   <div class="set">';o+='        <div class="form-field">';o+='            <select  id="'+this.id+'-wused-selected-picker">';o+='                  <option value="">'+this.msg(l+".picker.choose")+"</option>";o+='                  <option value="selectlines">'+this.msg(l+".picker.selectedlines")+"</option>";for(var t in q[0].itemData){if(t.indexOf("assoc_")>-1){s=true;o+="<option value='"+t+"'>"+this.datalistColumns[t].label+"</option>"}}o+="            </select>";o+="          </div>";o+="       </div>";o+="    </div>";o+='<div id="'+this.id+"-"+l+'-ft" class="bdft">';o+="</div>";o+="</form></div>";if(l=="bulk-edit"||(s&&this.datalistMeta.name.indexOf("WUsed")!=0)){var r=document.createElement("div");r.innerHTML=o;this.widgets.wUsedPanel=Alfresco.util.createYUIPanel(r,{draggable:true,width:"25em"});this.widgets.wUsedPanel.show();if(s){YAHOO.util.Event.on(YAHOO.util.Dom.get(this.id+"-wused-selected-picker"),"change",function(u){var v=this.value=="selectlines"?null:this.value;n.call(this,v,v)})}else{n.call(this)}}else{if(this.datalistMeta.name.indexOf("WUsed")==0){var m=null,p="assoc_bcpg_compoListProduct";if(this.datalistMeta.name.indexOf("|")>0){m="assoc_"+this.datalistMeta.name.split("|")[1].replace(":","_")}else{if(this.datalistMeta.itemType==="bcpg:packagingList"){m="assoc_bcpg_packagingListProduct";p=m}else{if(this.datalistMeta.itemType==="mpm:processList"){m="assoc_mpm_plResource";p=m}else{m="assoc_bcpg_compoListProduct"}}}n.call(this,m,p)}else{n.call(this)}}},onActionShowComments:function e(m){var l=Alfresco.constants.URL_SERVICECONTEXT+"modules/comments/list?nodeRef="+m.nodeRef+"&activityType=datalist"+(m.siteId?"&site="+m.siteId:"")+(this.options.entityNodeRef?"&entityNodeRef="+this.options.entityNodeRef:"");this._showPanel(l,this.id+"_comments",m.nodeRef)},onActionShowWused:function c(m){var l=YAHOO.lang.isArray(m)?m:[m];function n(t,r){var s=[];for(var p=0,q=l.length;p<q;p++){if(!r){s.push(l[p].nodeRef)}else{if(l[p].itemData[t].value){s.push(l[p].itemData[t].value)}else{for(var o in l[p].itemData[t]){s.push(l[p].itemData[t][o].value)}}}}if(!r){window.location=Alfresco.constants.URL_PAGECONTEXT+"wused?type="+l[0].itemType+"&nodeRefs="+s.join()}else{window.location=Alfresco.constants.URL_PAGECONTEXT+"wused?assocName="+r+"&nodeRefs="+s.join()}}this._showWusedPopup("wused",l,n)},onAddLabelingAspect:function b(o){var l=YAHOO.lang.isArray(o)?o:[o];for(var m=0,n=l.length;m<n;m++){this._manageAspect(l[m].nodeRef,"pack:labelingAspect")}},onActionSimulate:function g(o){var l=YAHOO.lang.isArray(o)?o:[o],p=this,r="";for(var m=0,n=l.length;m<n;m++){if(r.length>0){r+=","}r+=l[m].nodeRef}Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"becpg/entity/simulation/create?dataListItems="+r,successCallback:{fn:function(u){if(u.json){for(var s=0,t=l.length;s<t;s++){YAHOO.Bubbling.fire(p.scopeId+"dataItemUpdated",{nodeRef:l[s].nodeRef})}}},scope:this},failureCallback:{fn:function q(s){Alfresco.util.PopupManager.displayMessage({text:p.msg("message.details.failure")})},scope:this}})},_manageAspect:function f(n,l){var o=n.replace(":/",""),m=this;Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/slingshot/doclib/aspects/node/"+o,method:Alfresco.util.Ajax.GET,successCallback:{fn:function(r){if(r.json){var q=null;var t="delete-aspect";if(beCPG.util.contains(r.json.current,"pack:labelingAspect")){q={added:[],removed:[l]}}else{t="add-aspect";q={added:[l],removed:[]}}Alfresco.util.PopupManager.displayPrompt({title:m.msg("message.confirm."+t+".title",m.msg("aspect."+l.replace(":","_"))),text:m.msg("message.confirm."+t+".description",m.msg("aspect."+l.replace(":","_"))),buttons:[{text:m.msg("button."+t),handler:function p(){this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/action/aspects/node/"+o,method:Alfresco.util.Ajax.POST,requestContentType:Alfresco.util.Ajax.JSON,dataObj:q,successCallback:{fn:function(){YAHOO.Bubbling.fire(m.scopeId+"dataItemUpdated",{nodeRef:n})},scope:this},successMessage:m.msg("message.success."+t,m.msg("aspect."+l.replace(":","_")))})}},{text:this.msg("button.cancel"),handler:function s(){this.destroy()},isDefault:true}]})}},scope:this},})},_showPanel:function k(l,o,n){var m=this;Alfresco.util.Ajax.request({url:l,dataObj:{htmlid:o},successCallback:{fn:function(p){var r=document.createElement("div");r.innerHTML=p.serverResponse.responseText;var q=Dom.getFirstChild(r);this.widgets.panel=Alfresco.util.createYUIPanel(q,{draggable:true,width:"50em"});this.widgets.panel.subscribe("hide",function(){YAHOO.Bubbling.fire(m.scopeId+"dataItemUpdated",{nodeRef:n})});this.widgets.panel.show()},scope:this},failureMessage:"Could not load dialog template from '"+l+"'.",scope:this,execScripts:true})}};YAHOO.lang.augmentProto(beCPG.module.EntityDataGridActions,beCPG.module.CustomEntityDataGridActions)})();